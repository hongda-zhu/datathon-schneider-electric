# üöÄ Quick Reference - Datathon Dashboard

**Last Updated:** 2025-11-16
**Status:** Production Ready

---

## ‚ö° Quick Start

```bash
# 1. Ensure you have updated output/ folder from Colab
# 2. Run dashboard
./run_final.sh

# Or manually:
source venv/bin/activate
streamlit run app_final.py
```

Open: http://localhost:8501

---

## üìÅ File Structure

```
‚îú‚îÄ‚îÄ app_final.py                          ‚Üê Main dashboard (run this)
‚îú‚îÄ‚îÄ run_final.sh                           ‚Üê Quick launcher
‚îú‚îÄ‚îÄ requirements.txt                       ‚Üê Python dependencies
‚îÇ
‚îú‚îÄ‚îÄ output/                                ‚Üê Generated by Colab
‚îÇ   ‚îú‚îÄ‚îÄ model.pkl
‚îÇ   ‚îú‚îÄ‚îÄ explainer.pkl
‚îÇ   ‚îú‚îÄ‚îÄ X_test.pkl, y_test.pkl
‚îÇ   ‚îú‚îÄ‚îÄ shap_values.pkl
‚îÇ   ‚îú‚îÄ‚îÄ json/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ global_insights.json           ‚Üê Model performance + global SHAP
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ {id}.json                      ‚Üê Per-opportunity analysis
‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îÇ       ‚îú‚îÄ‚îÄ shap_summary.png
‚îÇ       ‚îî‚îÄ‚îÄ probability_distribution.png
‚îÇ
‚îú‚îÄ‚îÄ Colab Integration:
‚îÇ   ‚îî‚îÄ‚îÄ colab_full_pipeline.py             ‚Üê Copy entire script into Colab
‚îÇ
‚îî‚îÄ‚îÄ Documentation:
    ‚îú‚îÄ‚îÄ START_HERE.md                      ‚Üê Original getting started guide
    ‚îú‚îÄ‚îÄ DELIVERABLES_VERIFICATION.md       ‚Üê Proof of datathon requirements
    ‚îú‚îÄ‚îÄ IMPROVEMENTS_IMPLEMENTED.md        ‚Üê Round 1 improvements
    ‚îú‚îÄ‚îÄ IMPROVEMENTS_ROUND_2.md            ‚Üê Round 2 improvements
    ‚îî‚îÄ‚îÄ QUICK_REFERENCE.md                 ‚Üê This file
```

---

## üéØ Dashboard Pages

### Page 1: üåç Global Insights
- Model performance metrics (F1, AUC, Precision, Recall)
- AI-generated business insights (from Gemini)
- Probability distribution chart (Low/Med/High buckets)
- Top influential features (bar chart)
- SHAP summary plot with textual drivers

### Page 2: üîç Case Explorer
- Select opportunity by ID
- Confidence explanation with threshold distance
- Key features with Low/Avg/High labels
- Top SHAP drivers (Push Toward Win / Holds It Back)
- SHAP waterfall with text summary
- SHAP glossary (expandable)
- AI-generated recommendations

### Page 3: üé≤ What-If Simulator
- Select base opportunity
- Quick scenario preset buttons
- Adjustable sliders with context
- Detailed change summary
- Real-time probability updates
- Updated SHAP explanation

---

## üîß Colab Integration

1. Instala dependencias y descarga el dataset en Colab.
2. Define tu API key antes de ejecutar (opcional):
   ```python
   import os
   os.environ["GEMINI_API_KEY"] = "tu_api_key"
   ```
3. **Copia todo `colab_full_pipeline.py` en una celda y ejec√∫tala**.
   - El script entrena, genera SHAP, calcula estad√≠sticas y guarda `output/`.
   - Si `GEMINI_API_KEY` existe, a√±ade insights/recomendaciones autom√°ticas.
4. Descarga `output.zip`, extr√°elo aqu√≠ y ejecuta `app_final.py`.

---

## ‚ú® Key Features

### Round 1 Improvements:
‚úÖ Fixed contradictory Gemini insights (now mentions opp_old as dominant)
‚úÖ Added probability distribution chart
‚úÖ Added SHAP drivers textual summary
‚úÖ Removed duplicate feature importance visualization
‚úÖ Simplified recommendations display
‚úÖ Better text contrast (#1a1a1a)
‚úÖ Simplified chart explanations

### Round 2 Improvements:
‚úÖ Confidence explanation with threshold distance
‚úÖ Top SHAP factors as text lists
‚úÖ Low/Avg/High context labels for features
‚úÖ Unified confidence logic (threshold-based)
‚úÖ SHAP waterfall text summary
‚úÖ SHAP glossary (expandable)
‚úÖ What-If preset action buttons
‚úÖ Detailed change summary in What-If
‚úÖ Enhanced slider labels with percentiles

---

## üìä Data Requirements

### global_insights.json must contain:
```json
{
  "model_performance": { "f1_score", "auc", "precision", "recall", "threshold" },
  "feature_importance_top20": { "feature_name": importance_value, ... },
  "prediction_distribution": {
    "total_samples", "predicted_wins", "win_rate",
    "probability_buckets": { "Low (0-30%)": count, ... }
  },
  "shap_drivers": {
    "top_positive": [{"feature", "mean_shap"}, ...],
    "top_negative": [{"feature", "mean_shap"}, ...]
  },
  "feature_statistics": {
    "feature_name": {"mean", "median", "p25", "p50", "p75", ...},
    ...
  },
  "business_insights": [...],
  "recommendations": [...]
}
```

### {id}.json must contain:
```json
{
  "opportunity_id": "102",
  "prediction": { "win_probability", "threshold", "predicted_outcome", "actual_outcome" },
  "key_features": { "customer_activity", "total_competitors", "opp_old", ... },
  "shap_analysis": {
    "base_value",
    "prediction_value",
    "top_positive_factors": [{"feature", "shap_value", "explanation"}, ...],
    "top_negative_factors": [...]
  },
  "business_recommendation": {
    "action", "priority",
    "next_steps": [...]
  }
}
```

---

## üé® Feature Translations

All technical feature names are automatically translated:

| Technical | Business-Friendly |
|-----------|-------------------|
| `customer_activity` | Customer Activity Level |
| `total_competitors` | Total Competitors |
| `opp_old` | Opportunity Age |
| `cust_hitrate` | Customer Success Rate |
| `product_A_ratio` | Product A Ratio |
| `cust_interactions` | Customer Interactions |
| `cust_contracts` | Customer Contracts |

*Full mapping in `app_final.py` lines 65-113*

---

## üîç Confidence Levels

Based on distance from optimal threshold:

| Distance | Level | Icon | Box Color |
|----------|-------|------|-----------|
| >40pp | High | ‚úÖ | Green (success-box) |
| 10-40pp | Medium-High | ‚úÖ | Green (success-box) |
| 0-10pp | Medium | ‚ö†Ô∏è | Orange (warning-box) |
| <0pp (below) | Low | ‚ùå | Orange (warning-box) |

Example:
- Probability: 47.3%
- Threshold: 31.5%
- Distance: 15.8pp ‚Üí **Medium** confidence

---

## üéØ What-If Preset Actions

| Button | Effect |
|--------|--------|
| üìà +20% Interactions | Increases `cust_interactions` by 20% |
| üéØ Reduce Competitors | Decreases `total_competitors` by 1 |
| ‚ö° Fast-Track (New) | Sets `opp_old` to -1.0 (very new) |
| üîÑ Reset to Original | Restores all sliders to original values |

---

## üêõ Common Issues

### Dashboard won't start
```bash
# Check dependencies
pip list | grep streamlit

# Reinstall if needed
pip install -r requirements.txt
```

### Missing global_insights.json
```bash
# Make sure output/ folder exists
ls output/json/

# Re-download from Colab if missing
```

### "feature_statistics not found"
- Add `colab_feature_percentiles.py` code to Colab Section 8
- Re-run Colab to regenerate global_insights.json

### "No module named 'shap'"
```bash
pip install shap
```

### Charts not loading
```bash
# Check images exist
ls output/images/

# If missing, re-run Colab Section 7
```

---

## üìà Performance Metrics

### Expected Model Performance:
- **F1 Score:** ~0.82-0.84
- **AUC:** ~0.92
- **Precision:** ~0.77
- **Recall:** ~0.91

### Dashboard Load Time:
- Initial: ~2-3 seconds (loading model/data)
- Page switch: <1 second
- What-If simulation: <1 second

---

## üèÜ Datathon Deliverables

All 4 requirements met:

1. ‚úÖ **Model performance summary**
   ‚Üí Global Insights page, metrics with tooltips

2. ‚úÖ **Explainability technique proposal**
   ‚Üí SHAP (global + local), What-If simulator, tooltips explain usage

3. ‚úÖ **Insights on why Win/Loss**
   ‚Üí 3 levels: Global patterns, Case-specific drivers, AI recommendations

4. ‚úÖ **LLM interprets SHAP**
   ‚Üí Gemini generates business insights from SHAP + performance

*See `DELIVERABLES_VERIFICATION.md` for detailed proof*

---

## üí° Pro Tips

### For Presentation:
- Start with Global Insights (big picture)
- Demo Case Explorer with a high-confidence win (shows positive factors clearly)
- Demo Case Explorer with a low-confidence case (shows clear obstacles)
- Use What-If to show impact of reducing competitors
- Highlight Gemini AI insights as unique differentiator

### For Judges:
- Mention threshold-based confidence (not arbitrary 0.7/0.4)
- Show SHAP glossary (built-in education)
- Demonstrate preset buttons (business-user friendly)
- Point out Low/Avg/High labels (no ML knowledge needed)

### For Development:
- All feature translations in FEATURE_TRANSLATIONS dict
- Modify confidence thresholds in lines 594-625
- Add new preset actions in lines 831-858
- Customize SHAP glossary in lines 713-729

---

## üìû Quick Debugging

### Dashboard shows errors:
```python
# Check Python version
python --version  # Should be 3.12

# Check Streamlit version
streamlit --version  # Should be >=1.28

# Run with debug
streamlit run app_final.py --logger.level=debug
```

### Gemini insights son gen√©ricos:
- Aseg√∫rate de ejecutar la √∫ltima versi√≥n de `colab_full_pipeline.py`
- Verifica que `GEMINI_API_KEY` est√© definido antes de correr el pipeline
- Comprueba que `global_insights.json` tenga campos `feature_importance_top20` y `shap_drivers`

### Features show no context labels:
- Check `global_insights["feature_statistics"]` exists
- Verify feature names match between JSON and dashboard
- Make sure percentiles were calculated in Colab

---

## üîó Related Files

- **Full Round 1 Details:** `IMPROVEMENTS_IMPLEMENTED.md`
- **Full Round 2 Details:** `IMPROVEMENTS_ROUND_2.md`
- **Deliverables Proof:** `DELIVERABLES_VERIFICATION.md`
- **Original Guide:** `START_HERE.md`

---

**Need help?** Check the detailed documentation files above! üöÄ
